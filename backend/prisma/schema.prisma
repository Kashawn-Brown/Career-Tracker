// This is a Prisma schema that defines the database structure for a job application tracking system.
// Job Application Tracking System Database Schema
// Defines the data structure for a personal job search management application
// that allows users to track applications, contacts, documents, and organize with tags

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - stores user profile information
model User {
  id           Int    @id @default(autoincrement())
  email        String @unique
  name         String
  resumeLink   String?
  githubLink   String?
  linkedinLink String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  jobApplications JobApplication[]
  
  @@map("users")
}

// JobApplication model - main entity for tracking job applications
model JobApplication {
  id                 Int       @id @default(autoincrement())
  userId             Int
  company            String
  position           String
  dateApplied        DateTime  @default(now())
  status             String    @default("applied") // applied, interview, offer, rejected, withdrawn
  type               String?   // full-time, part-time, contract, internship
  salary             Int?
  jobLink            String?
  compatibilityScore Int?      @default(0)
  notes              String?
  isStarred          Boolean   @default(false)
  followUpDate       DateTime?
  deadline           DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  
  // Relations
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  tags       Tag[]
  people     Person[]
  documents  Document[]
  
  @@map("job_applications")
  @@index([userId])
  @@index([status])
  @@index([dateApplied])
}

// Tag model - for categorizing job applications
model Tag {
  id               Int    @id @default(autoincrement())
  label            String
  jobApplicationId Int
  createdAt        DateTime @default(now())
  
  // Relations
  jobApplication JobApplication @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)
  
  @@map("tags")
  @@index([jobApplicationId])
}

// Person model - for tracking contacts related to job applications
model Person {
  id               Int    @id @default(autoincrement())
  name             String
  role             String
  email            String?
  phone            String?
  jobApplicationId Int
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // Relations
  jobApplication JobApplication @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)
  
  @@map("people")
  @@index([jobApplicationId])
}

// Document model - for storing uploaded files related to job applications
model Document {
  id               Int    @id @default(autoincrement())
  fileUrl          String
  fileName         String
  fileSize         Int?
  type             String // resume, cover_letter, portfolio
  jobApplicationId Int
  createdAt        DateTime @default(now())
  
  // Relations
  jobApplication JobApplication @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)
  
  @@map("documents")
  @@index([jobApplicationId])
  @@index([type])
}


// The schema establishes relationships between these entities 
// (users have many job applications, applications have many tags/people/documents) and includes proper indexing for performance. 
// It's essentially a database design for a personal job search management app.
