// This Prisma schema defines the database structure for a job application tracking system.
// It includes models for users, job applications, contacts, documents, and their relationships.
// The schema supports features like job application management, contact tracking, document storage,
// and tagging system to help users organize their job search process.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int              @id @default(autoincrement())
  email           String           @unique
  name            String
  resumeLink      String?
  githubLink      String?
  linkedinLink    String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  contacts        Contact[]
  jobApplications JobApplication[]

  @@map("users")
}

model JobApplication {
  id                 Int             @id @default(autoincrement())
  userId             Int
  company            String
  position           String
  dateApplied        DateTime        @default(now())
  status             String          @default("applied")
  type               String?
  salary             Int?
  jobLink            String?
  compatibilityScore Int?            @default(0)
  notes              String?
  isStarred          Boolean         @default(false)
  followUpDate       DateTime?
  deadline           DateTime?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  documents          Document[]
  user               User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobConnections     JobConnection[]
  tags               Tag[]

  @@index([userId])
  @@index([status])
  @@index([dateApplied])
  @@map("job_applications")
}

model Tag {
  id               Int            @id @default(autoincrement())
  label            String
  jobApplicationId Int
  createdAt        DateTime       @default(now())
  jobApplication   JobApplication @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)

  @@index([jobApplicationId])
  @@map("tags")
}

model Contact {
  id             Int             @id @default(autoincrement())
  userId         Int
  name           String
  email          String?
  phone          String?
  company        String?
  role           String?
  linkedinUrl    String?
  connectionType String?
  notes          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobConnections JobConnection[]

  @@index([userId])
  @@map("contacts")
}

model JobConnection {
  id               Int            @id @default(autoincrement())
  jobApplicationId Int
  contactId        Int?
  name             String
  email            String?
  phone            String?
  company          String?
  role             String?
  connectionType   String
  status           String         @default("not_contacted")
  notes            String?
  contactedAt      DateTime?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  contact          Contact?       @relation(fields: [contactId], references: [id])
  jobApplication   JobApplication @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)

  @@index([jobApplicationId])
  @@index([contactId])
  @@map("job_connections")
}

model Document {
  id               Int            @id @default(autoincrement())
  fileUrl          String
  fileName         String
  fileSize         Int?
  type             String
  jobApplicationId Int
  createdAt        DateTime       @default(now())
  jobApplication   JobApplication @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)

  @@index([jobApplicationId])
  @@index([type])
  @@map("documents")
}
